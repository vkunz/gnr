<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>ProjectGNR: Y:/PROJECTS/GNR/src/Scene.cpp Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='../../open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='../../closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='../../closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../classes.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>Y:/PROJECTS/GNR/src/Scene.cpp</h1><a href="../../d9/d44/_scene_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00011"></a>00011 <span class="preprocessor">#include "<a class="code" href="../../de/d56/_scene_8h.html">Scene.h</a>"</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include "<a class="code" href="../../da/dc5/_notify_event_8h.html">NotifyEvent.h</a>"</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include "<a class="code" href="../../d2/d46/_global_define_8h.html">GlobalDefine.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="../../d0/d3e/_tree_scene_item_data_8h.html">TreeSceneItemData.h</a>"</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="comment">// initialize pointer</span>
<a name="l00017"></a>00017 <a class="code" href="../../d6/db5/class_scene.html">Scene</a>* <a class="code" href="../../d6/db5/class_scene.html#bd3b7332bb7cb275ad0849fa650459f8">Scene::pinstance</a> = 0;
<a name="l00018"></a>00018 
<a name="l00023"></a><a class="code" href="../../d6/db5/class_scene.html#d10176d75a9cc0da56626f682d083507">00023</a> <a class="code" href="../../d6/db5/class_scene.html#d10176d75a9cc0da56626f682d083507">Scene::Scene</a>()
<a name="l00024"></a>00024 {
<a name="l00025"></a>00025         <a class="code" href="../../d6/db5/class_scene.html#e621a1c2ded92d3625192476331df7c0">m_shadows</a> = <span class="keyword">true</span>;
<a name="l00026"></a>00026 
<a name="l00027"></a>00027         <a class="code" href="../../d6/db5/class_scene.html#89095bc8392804acb0280712e3c0d5ee">initContainers</a>();
<a name="l00028"></a>00028 
<a name="l00029"></a>00029         <a class="code" href="../../d6/db5/class_scene.html#aa26c5e3420d61bc3d0018ce62bad9c9">m_GLCamera2D</a>    = <span class="keyword">new</span> <a class="code" href="../../da/d43/class_g_l_camera.html">GLCamera</a>();
<a name="l00030"></a>00030         <a class="code" href="../../d6/db5/class_scene.html#887bc000ffc9174e5f154cc86a10f7fb">m_GLCamera3D</a>    = <span class="keyword">new</span> <a class="code" href="../../da/d43/class_g_l_camera.html">GLCamera</a>();
<a name="l00031"></a>00031 
<a name="l00032"></a>00032         <a class="code" href="../../d6/db5/class_scene.html#93d9a1c2b5ffbc686d77e3791c3a6ff0">resetCamera</a>();
<a name="l00033"></a>00033 }
<a name="l00034"></a>00034 
<a name="l00039"></a><a class="code" href="../../d6/db5/class_scene.html#3b8cec2e32546713915f8c6303c951f1">00039</a> <a class="code" href="../../d6/db5/class_scene.html#3b8cec2e32546713915f8c6303c951f1">Scene::~Scene</a>()
<a name="l00040"></a>00040 {
<a name="l00041"></a>00041         <a class="code" href="../../d6/db5/class_scene.html#08ff45b6ca2145bb53cc5480c25ae008">destroyContainers</a>();
<a name="l00042"></a>00042 
<a name="l00043"></a>00043         <span class="keyword">delete</span> <a class="code" href="../../d6/db5/class_scene.html#aa26c5e3420d61bc3d0018ce62bad9c9">m_GLCamera2D</a>;
<a name="l00044"></a>00044         <span class="keyword">delete</span> <a class="code" href="../../d6/db5/class_scene.html#887bc000ffc9174e5f154cc86a10f7fb">m_GLCamera3D</a>;
<a name="l00045"></a>00045 }
<a name="l00046"></a>00046 
<a name="l00052"></a><a class="code" href="../../d6/db5/class_scene.html#e4f764527c8b962eba443129e023492c">00052</a> <a class="code" href="../../d6/db5/class_scene.html">Scene</a>* <a class="code" href="../../d6/db5/class_scene.html#e4f764527c8b962eba443129e023492c">Scene::getInstance</a>()
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054         <span class="keywordflow">if</span> (<a class="code" href="../../d6/db5/class_scene.html#bd3b7332bb7cb275ad0849fa650459f8">pinstance</a> == 0)
<a name="l00055"></a>00055         {
<a name="l00056"></a>00056                 <a class="code" href="../../d6/db5/class_scene.html#bd3b7332bb7cb275ad0849fa650459f8">pinstance</a> = <span class="keyword">new</span> <a class="code" href="../../d6/db5/class_scene.html">Scene</a>;
<a name="l00057"></a>00057         }
<a name="l00058"></a>00058         <span class="keywordflow">return</span> <a class="code" href="../../d6/db5/class_scene.html#bd3b7332bb7cb275ad0849fa650459f8">pinstance</a>;
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 
<a name="l00065"></a><a class="code" href="../../d6/db5/class_scene.html#bbdf164183f4c7f00ddd4257f6bf22a3">00065</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#bbdf164183f4c7f00ddd4257f6bf22a3">Scene::setAssembly</a>(<a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* assembly)
<a name="l00066"></a>00066 {
<a name="l00067"></a>00067         <a class="code" href="../../d6/db5/class_scene.html#b15c7e31da9772371ad4441a1a938d68">m_Assembly</a> = assembly;
<a name="l00068"></a>00068 }
<a name="l00069"></a>00069 
<a name="l00074"></a><a class="code" href="../../d6/db5/class_scene.html#40293aab8bd2ffbe569d7a024c9c590a">00074</a> <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* <a class="code" href="../../d6/db5/class_scene.html#40293aab8bd2ffbe569d7a024c9c590a">Scene::getAssembly</a>()
<a name="l00075"></a>00075 {
<a name="l00076"></a>00076         <span class="keywordflow">return</span> <a class="code" href="../../d6/db5/class_scene.html#b15c7e31da9772371ad4441a1a938d68">m_Assembly</a>;
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00083"></a><a class="code" href="../../d6/db5/class_scene.html#9734d1bd04f724bc375d31915478470a">00083</a> <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* <a class="code" href="../../d6/db5/class_scene.html#9734d1bd04f724bc375d31915478470a">Scene::getRootAssembly</a>()
<a name="l00084"></a>00084 {
<a name="l00085"></a>00085         <span class="keywordflow">return</span> <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>;
<a name="l00086"></a>00086 }
<a name="l00087"></a>00087 
<a name="l00092"></a><a class="code" href="../../d6/db5/class_scene.html#438c0c7ede2054c0a9eee18f05045ce5">00092</a> <a class="code" href="../../da/d43/class_g_l_camera.html">GLCamera</a>* <a class="code" href="../../d6/db5/class_scene.html#438c0c7ede2054c0a9eee18f05045ce5">Scene::getGLCamera2D</a>()
<a name="l00093"></a>00093 {
<a name="l00094"></a>00094         <span class="keywordflow">return</span> <a class="code" href="../../d6/db5/class_scene.html#aa26c5e3420d61bc3d0018ce62bad9c9">m_GLCamera2D</a>;
<a name="l00095"></a>00095 }
<a name="l00096"></a>00096 
<a name="l00101"></a><a class="code" href="../../d6/db5/class_scene.html#de5fa271cdbb9b7db995c5e4af1f3a48">00101</a> <a class="code" href="../../da/d43/class_g_l_camera.html">GLCamera</a>* <a class="code" href="../../d6/db5/class_scene.html#de5fa271cdbb9b7db995c5e4af1f3a48">Scene::getGLCamera3D</a>()
<a name="l00102"></a>00102 {
<a name="l00103"></a>00103         <span class="keywordflow">return</span> <a class="code" href="../../d6/db5/class_scene.html#887bc000ffc9174e5f154cc86a10f7fb">m_GLCamera3D</a>;
<a name="l00104"></a>00104 }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 
<a name="l00111"></a><a class="code" href="../../d6/db5/class_scene.html#3bd288f5220316ab4af5b44bfa12ac90">00111</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#3bd288f5220316ab4af5b44bfa12ac90">Scene::toggleShadows</a>(<span class="keywordtype">bool</span> status)
<a name="l00112"></a>00112 {
<a name="l00113"></a>00113         <a class="code" href="../../d6/db5/class_scene.html#e621a1c2ded92d3625192476331df7c0">m_shadows</a> = status;
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00119"></a><a class="code" href="../../d6/db5/class_scene.html#89095bc8392804acb0280712e3c0d5ee">00119</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#89095bc8392804acb0280712e3c0d5ee">Scene::initContainers</a>()
<a name="l00120"></a>00120 {
<a name="l00121"></a>00121         <a class="code" href="../../d6/db5/class_scene.html#b15c7e31da9772371ad4441a1a938d68">m_Assembly</a> = NULL;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123         <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>  = <span class="keyword">new</span> <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#9867f03749a40c51d1474b8d3bd04b747e87c3cbb8eadcba9b3b8c95219f88aa">IS_ROOT</a>,        wxT(<span class="stringliteral">"scene"</span>));
<a name="l00124"></a>00124         <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>      = <span class="keyword">new</span> <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#9867f03749a40c51d1474b8d3bd04b74366f54957940b07abbbc005dd696adee">IS_SELECTED</a>,    wxT(<span class="stringliteral">"selected"</span>));
<a name="l00125"></a>00125 
<a name="l00126"></a>00126         <span class="comment">//put selected assembly in real world</span>
<a name="l00127"></a>00127         <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>(<a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>);
<a name="l00128"></a>00128 
<a name="l00129"></a>00129         <a class="code" href="../../d6/db5/class_scene.html#3d621c528dca6465b8f461b42378a860">m_Trash</a>         = <span class="keyword">new</span> <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#9867f03749a40c51d1474b8d3bd04b74380df5c45e409c328af56406573c2416">IS_TRASH</a>,       wxT(<span class="stringliteral">"trash"</span>));
<a name="l00130"></a>00130         <a class="code" href="../../d6/db5/class_scene.html#dd9b5ce6ab56cc95c9e78301e5431913">m_Duplicator</a>    = <span class="keyword">new</span> <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#9867f03749a40c51d1474b8d3bd04b74dcf1f35ed351bbd192b6b73a95ac4d56">IS_DUPLICATOR</a>,  wxT(<span class="stringliteral">"duplicator"</span>));
<a name="l00131"></a>00131         <a class="code" href="../../d6/db5/class_scene.html#cd4f2edb06574753cdfe6c976c3fd53d">m_Originals</a>     = <span class="keyword">new</span> <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#9867f03749a40c51d1474b8d3bd04b740ef7cc53b7d6a35eac5ff91c905b8c25">IS_ORIGINAL</a>,    wxT(<span class="stringliteral">"originals"</span>));
<a name="l00132"></a>00132 }
<a name="l00133"></a>00133 
<a name="l00137"></a><a class="code" href="../../d6/db5/class_scene.html#08ff45b6ca2145bb53cc5480c25ae008">00137</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#08ff45b6ca2145bb53cc5480c25ae008">Scene::destroyContainers</a>()
<a name="l00138"></a>00138 {
<a name="l00139"></a>00139         <span class="comment">//disconnect selected part</span>
<a name="l00140"></a>00140         <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#db9582f954f8764cd1431455af7fff6f">delPart</a>(<a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142         <span class="comment">//selected is killed, then root</span>
<a name="l00143"></a>00143         <span class="keyword">delete</span> <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>;
<a name="l00144"></a>00144         <span class="keyword">delete</span> <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146         <span class="comment">//kill all temp containers</span>
<a name="l00147"></a>00147         <span class="keyword">delete</span> <a class="code" href="../../d6/db5/class_scene.html#3d621c528dca6465b8f461b42378a860">m_Trash</a>;
<a name="l00148"></a>00148         <span class="keyword">delete</span> <a class="code" href="../../d6/db5/class_scene.html#dd9b5ce6ab56cc95c9e78301e5431913">m_Duplicator</a>;
<a name="l00149"></a>00149         <span class="keyword">delete</span> <a class="code" href="../../d6/db5/class_scene.html#cd4f2edb06574753cdfe6c976c3fd53d">m_Originals</a>;
<a name="l00150"></a>00150 }
<a name="l00151"></a>00151 
<a name="l00155"></a><a class="code" href="../../d6/db5/class_scene.html#311e8fa66af7b561ae49a49290e31b69">00155</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#311e8fa66af7b561ae49a49290e31b69">Scene::newRoom</a>()
<a name="l00156"></a>00156 {
<a name="l00157"></a>00157         <a class="code" href="../../d6/db5/class_scene.html#08ff45b6ca2145bb53cc5480c25ae008">destroyContainers</a>();
<a name="l00158"></a>00158         <a class="code" href="../../d6/db5/class_scene.html#89095bc8392804acb0280712e3c0d5ee">initContainers</a>();
<a name="l00159"></a>00159         <a class="code" href="../../d6/db5/class_scene.html#93d9a1c2b5ffbc686d77e3791c3a6ff0">resetCamera</a>();
<a name="l00160"></a>00160 
<a name="l00161"></a>00161         <span class="comment">// send event to refresh Scene-Tree</span>
<a name="l00162"></a>00162         <a class="code" href="../../d1/d0e/class_notify_event.html">NotifyEvent</a> gnrevent(wxEVT_COMMAND_GNR_NOTIFY);
<a name="l00163"></a>00163         gnrevent.<a class="code" href="../../d1/d0e/class_notify_event.html#f51e30f058656f7f19536efc049be923">setGNREventType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#3017adf344c435005db11e8c0d8c03bd92d1c11b5acee51a4090d8c1ae57a6f0">REFRESHSCENETREE</a>);
<a name="l00164"></a>00164         ProcessEvent(gnrevent);
<a name="l00165"></a>00165 }
<a name="l00166"></a>00166 
<a name="l00170"></a><a class="code" href="../../d6/db5/class_scene.html#93d9a1c2b5ffbc686d77e3791c3a6ff0">00170</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#93d9a1c2b5ffbc686d77e3791c3a6ff0">Scene::resetCamera</a>()
<a name="l00171"></a>00171 {
<a name="l00172"></a>00172         <span class="comment">//reset 2D cam to default</span>
<a name="l00173"></a>00173         <a class="code" href="../../d6/db5/class_scene.html#aa26c5e3420d61bc3d0018ce62bad9c9">m_GLCamera2D</a>-&gt;<a class="code" href="../../da/d43/class_g_l_camera.html#2c5e42bda3b533852a83fd62608ae3db">reset</a>();
<a name="l00174"></a>00174         <a class="code" href="../../d6/db5/class_scene.html#aa26c5e3420d61bc3d0018ce62bad9c9">m_GLCamera2D</a>-&gt;<a class="code" href="../../da/d43/class_g_l_camera.html#613fa99c37d6f1c9da2147a6e4ce0fc2">rotateX</a>(-90);
<a name="l00175"></a>00175         <a class="code" href="../../d6/db5/class_scene.html#aa26c5e3420d61bc3d0018ce62bad9c9">m_GLCamera2D</a>-&gt;<a class="code" href="../../da/d43/class_g_l_camera.html#ac5f61e9969d0ce0f9be70db857eb139">changeDistance</a>(15);
<a name="l00176"></a>00176 
<a name="l00177"></a>00177         <span class="comment">//reset 3D cam to default</span>
<a name="l00178"></a>00178         <a class="code" href="../../d6/db5/class_scene.html#887bc000ffc9174e5f154cc86a10f7fb">m_GLCamera3D</a>-&gt;<a class="code" href="../../da/d43/class_g_l_camera.html#2c5e42bda3b533852a83fd62608ae3db">reset</a>();
<a name="l00179"></a>00179         <a class="code" href="../../d6/db5/class_scene.html#887bc000ffc9174e5f154cc86a10f7fb">m_GLCamera3D</a>-&gt;<a class="code" href="../../da/d43/class_g_l_camera.html#613fa99c37d6f1c9da2147a6e4ce0fc2">rotateX</a>(-40);
<a name="l00180"></a>00180         <a class="code" href="../../d6/db5/class_scene.html#887bc000ffc9174e5f154cc86a10f7fb">m_GLCamera3D</a>-&gt;<a class="code" href="../../da/d43/class_g_l_camera.html#ac5f61e9969d0ce0f9be70db857eb139">changeDistance</a>(12);
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 
<a name="l00183"></a><a class="code" href="../../d6/db5/class_scene.html#4c42a1db07683d60224a46e55a820643">00183</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#4c42a1db07683d60224a46e55a820643">Scene::setCanvas2D</a>(<a class="code" href="../../d7/df1/class_g_l_canvas2_d.html">GLCanvas2D</a>* p)
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185         <a class="code" href="../../d6/db5/class_scene.html#6563995309e1fb25d5ce58ab92e441db">m_Canvas2D</a> = p;
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00188"></a><a class="code" href="../../d6/db5/class_scene.html#7f94c8cad48cdb66e701a7560ae19c4b">00188</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#7f94c8cad48cdb66e701a7560ae19c4b">Scene::setCanvas3D</a>(<a class="code" href="../../d5/dbf/class_g_l_canvas3_d.html">GLCanvas3D</a>* p)
<a name="l00189"></a>00189 {
<a name="l00190"></a>00190         <a class="code" href="../../d6/db5/class_scene.html#11fb58f7b72970d786912a1f3454e572">m_Canvas3D</a> = p;
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00193"></a><a class="code" href="../../d6/db5/class_scene.html#30ed9011a03ff4a6891084318d0b0942">00193</a> <a class="code" href="../../d7/df1/class_g_l_canvas2_d.html">GLCanvas2D</a>* <a class="code" href="../../d6/db5/class_scene.html#30ed9011a03ff4a6891084318d0b0942">Scene::getCanvas2D</a>()
<a name="l00194"></a>00194 {
<a name="l00195"></a>00195         <span class="keywordflow">return</span> <a class="code" href="../../d6/db5/class_scene.html#6563995309e1fb25d5ce58ab92e441db">m_Canvas2D</a>;
<a name="l00196"></a>00196 }
<a name="l00197"></a>00197 
<a name="l00198"></a><a class="code" href="../../d6/db5/class_scene.html#9bbf5ca7b9e14e18c99a895fa181801d">00198</a> <a class="code" href="../../d5/dbf/class_g_l_canvas3_d.html">GLCanvas3D</a>* <a class="code" href="../../d6/db5/class_scene.html#9bbf5ca7b9e14e18c99a895fa181801d">Scene::getCanvas3D</a>()
<a name="l00199"></a>00199 {
<a name="l00200"></a>00200         <span class="keywordflow">return</span> <a class="code" href="../../d6/db5/class_scene.html#11fb58f7b72970d786912a1f3454e572">m_Canvas3D</a>;
<a name="l00201"></a>00201 }
<a name="l00202"></a>00202 
<a name="l00206"></a><a class="code" href="../../d6/db5/class_scene.html#5b81137c9b7c995108175d8a24f822ae">00206</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#5b81137c9b7c995108175d8a24f822ae">Scene::glRefresh</a>()
<a name="l00207"></a>00207 {
<a name="l00208"></a>00208         <a class="code" href="../../d6/db5/class_scene.html#878e7df9248559e82a5a6ec8195ff536">glRefresh3D</a>();
<a name="l00209"></a>00209         <a class="code" href="../../d6/db5/class_scene.html#580685ed1d9c3532b7bdc7490e7fabd6">glRefresh2D</a>();
<a name="l00210"></a>00210 }
<a name="l00211"></a>00211 
<a name="l00215"></a><a class="code" href="../../d6/db5/class_scene.html#dea4ebae5d8170217e1a979855c55917">00215</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#dea4ebae5d8170217e1a979855c55917">Scene::glRefreshCanvas</a>()
<a name="l00216"></a>00216 {
<a name="l00217"></a>00217         <span class="comment">//prepare and draw 2D top view of room</span>
<a name="l00218"></a>00218         <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#68ae53195e0e85373c2914c0f714b1ef">prepareDraw</a>();
<a name="l00219"></a>00219 
<a name="l00220"></a>00220         <span class="comment">//set camera for scene</span>
<a name="l00221"></a>00221         <a class="code" href="../../d6/db5/class_scene.html#2ee60d9e092d0723003a4e5fff434af9">m_GLCAM</a>-&gt;<a class="code" href="../../da/d43/class_g_l_camera.html#23734ccf4e8be643e3c6b7bc3d2626c8">render</a>();
<a name="l00222"></a>00222 
<a name="l00223"></a>00223         <span class="comment">/*NOW PREPARE THE PIXELBUFFER AND DRAW VIRTUAL FLOOR FOR CASTING SHADOWS*/</span>
<a name="l00224"></a>00224         <span class="keywordflow">if</span> (<a class="code" href="../../d6/db5/class_scene.html#e621a1c2ded92d3625192476331df7c0">m_shadows</a>)
<a name="l00225"></a>00225         {
<a name="l00226"></a>00226                 <span class="comment">//initialize only light source</span>
<a name="l00227"></a>00227                 <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#0a217a6dac41d7d16cb51bc2880b5e46">initLights</a>();
<a name="l00228"></a>00228 
<a name="l00229"></a>00229                 <span class="comment">//prepare pixelbuffer for shadows</span>
<a name="l00230"></a>00230                 <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#c791e43686e1f7139ecccf8019a83db9">preparePixelBuffer</a>();
<a name="l00231"></a>00231 
<a name="l00232"></a>00232                 <span class="comment">//draw invisible floor for shadow projection</span>
<a name="l00233"></a>00233                 <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#4e773fd347676178e60015ddd22768ad">drawBaseFloor</a>(0.0, 0.0, 0.0, <a class="code" href="../../d2/d46/_global_define_8h.html#7cacec5964b86e10fde43643414e2677">DEFAULT_FLOOR_SIZE</a>);
<a name="l00234"></a>00234 
<a name="l00235"></a>00235                 <span class="comment">//turn the color and depth buffers back on</span>
<a name="l00236"></a>00236                 <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#049a8ed970f34623a8845e19ae42ff5e">endPixelBuffer</a>();
<a name="l00237"></a>00237 
<a name="l00238"></a>00238                 <span class="comment">/*NOW CAST THE SHADOWS ON THE FLOOR AND KEEP IN PIXELBUFFER*/</span>
<a name="l00239"></a>00239 
<a name="l00240"></a>00240                 <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#4e773fd347676178e60015ddd22768ad">drawBaseFloor</a>(0.0, 0.0, 0.0, <a class="code" href="../../d2/d46/_global_define_8h.html#7cacec5964b86e10fde43643414e2677">DEFAULT_FLOOR_SIZE</a>);
<a name="l00241"></a>00241 
<a name="l00242"></a>00242                 <span class="comment">//draw all shadows of objects</span>
<a name="l00243"></a>00243                 glPushMatrix();
<a name="l00244"></a>00244                 {
<a name="l00245"></a>00245                         <span class="comment">//turn shadows on</span>
<a name="l00246"></a>00246                         <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#391b3812152e7cd5b5e6727b81f04905">shadowColorOn</a>();
<a name="l00247"></a>00247                         <span class="comment">//load shadow projection matrix</span>
<a name="l00248"></a>00248                         <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#a22fa22319bb80b056e1abf991cad0d7">loadShadowMatrix</a>();
<a name="l00249"></a>00249                         <span class="comment">//draw shadows on prepainted floor (1)</span>
<a name="l00250"></a>00250                         glPushMatrix();
<a name="l00251"></a>00251                         {
<a name="l00252"></a>00252                                 <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#af5da3f7a8447c83399e0b58596450e1">drawShadow</a>();
<a name="l00253"></a>00253                         }
<a name="l00254"></a>00254                         glPopMatrix();
<a name="l00255"></a>00255                         <span class="comment">//turn off shadows</span>
<a name="l00256"></a>00256                         <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#77c335465036944eda1a962c0ccd9a5d">shadowColorOff</a>();
<a name="l00257"></a>00257                 }
<a name="l00258"></a>00258                 glPopMatrix();
<a name="l00259"></a>00259 
<a name="l00260"></a>00260                 <span class="comment">/*NOW DRAW ALL OBJECTS WITHOUT SHADOWS AND BLEND WITH SHADOWS*/</span>
<a name="l00261"></a>00261         }
<a name="l00262"></a>00262 
<a name="l00263"></a>00263         <span class="comment">//draw real objects</span>
<a name="l00264"></a>00264         glPushMatrix();
<a name="l00265"></a>00265         {
<a name="l00266"></a>00266                 <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#0a217a6dac41d7d16cb51bc2880b5e46">initLights</a>();
<a name="l00267"></a>00267 
<a name="l00268"></a>00268                 <span class="keywordflow">if</span> (! <a class="code" href="../../d6/db5/class_scene.html#e621a1c2ded92d3625192476331df7c0">m_shadows</a>)
<a name="l00269"></a>00269                 {
<a name="l00270"></a>00270                         <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#4e773fd347676178e60015ddd22768ad">drawBaseFloor</a>(0.0, 0.0, 0.0, <a class="code" href="../../d2/d46/_global_define_8h.html#7cacec5964b86e10fde43643414e2677">DEFAULT_FLOOR_SIZE</a>);
<a name="l00271"></a>00271                 }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273                 <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#c9d3e547dd21a926b9f152bd42b01418">draw</a>();
<a name="l00274"></a>00274         }
<a name="l00275"></a>00275         glPopMatrix();
<a name="l00276"></a>00276 
<a name="l00277"></a>00277         <span class="comment">//finish output and flush</span>
<a name="l00278"></a>00278         <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#58d78457618b3e3c0120ab9a7fd8addb">endDraw</a>();
<a name="l00279"></a>00279 }
<a name="l00280"></a>00280 
<a name="l00284"></a><a class="code" href="../../d6/db5/class_scene.html#580685ed1d9c3532b7bdc7490e7fabd6">00284</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#580685ed1d9c3532b7bdc7490e7fabd6">Scene::glRefresh2D</a>()
<a name="l00285"></a>00285 {
<a name="l00286"></a>00286         <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a> = <a class="code" href="../../d6/db5/class_scene.html#6563995309e1fb25d5ce58ab92e441db">m_Canvas2D</a>;
<a name="l00287"></a>00287         <a class="code" href="../../d6/db5/class_scene.html#2ee60d9e092d0723003a4e5fff434af9">m_GLCAM</a> = <a class="code" href="../../d6/db5/class_scene.html#aa26c5e3420d61bc3d0018ce62bad9c9">m_GLCamera2D</a>;
<a name="l00288"></a>00288         <a class="code" href="../../d6/db5/class_scene.html#dea4ebae5d8170217e1a979855c55917">glRefreshCanvas</a>();
<a name="l00289"></a>00289 }
<a name="l00290"></a>00290 
<a name="l00294"></a><a class="code" href="../../d6/db5/class_scene.html#878e7df9248559e82a5a6ec8195ff536">00294</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#878e7df9248559e82a5a6ec8195ff536">Scene::glRefresh3D</a>()
<a name="l00295"></a>00295 {
<a name="l00296"></a>00296         <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a> = <a class="code" href="../../d6/db5/class_scene.html#11fb58f7b72970d786912a1f3454e572">m_Canvas3D</a>;
<a name="l00297"></a>00297         <a class="code" href="../../d6/db5/class_scene.html#2ee60d9e092d0723003a4e5fff434af9">m_GLCAM</a> = <a class="code" href="../../d6/db5/class_scene.html#887bc000ffc9174e5f154cc86a10f7fb">m_GLCamera3D</a>;
<a name="l00298"></a>00298         <a class="code" href="../../d6/db5/class_scene.html#dea4ebae5d8170217e1a979855c55917">glRefreshCanvas</a>();
<a name="l00299"></a>00299 }
<a name="l00300"></a>00300 
<a name="l00304"></a><a class="code" href="../../d6/db5/class_scene.html#c382a1cd67afddacdb9602d7467e1476">00304</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#c382a1cd67afddacdb9602d7467e1476">Scene::deleteSelectedAssemblies</a>()
<a name="l00305"></a>00305 {
<a name="l00306"></a>00306         list&lt;Assembly*&gt; parts = <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#ed4ea8b1f7dc109c964eb8f0c3c53626">getPartList</a>();
<a name="l00307"></a>00307 
<a name="l00308"></a>00308         <span class="keywordflow">for</span> (list&lt;Assembly*&gt;::iterator it = parts.begin(); it != parts.end(); ++it)
<a name="l00309"></a>00309         {
<a name="l00310"></a>00310                 <a class="code" href="../../d6/db5/class_scene.html#3d621c528dca6465b8f461b42378a860">m_Trash</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>((*it));
<a name="l00311"></a>00311                 <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#db9582f954f8764cd1431455af7fff6f">delPart</a>((*it));
<a name="l00312"></a>00312         }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314         <span class="comment">// send event to refresh Scene-Tree</span>
<a name="l00315"></a>00315         <a class="code" href="../../d1/d0e/class_notify_event.html">NotifyEvent</a> gnrevent(wxEVT_COMMAND_GNR_NOTIFY);
<a name="l00316"></a>00316         gnrevent.<a class="code" href="../../d1/d0e/class_notify_event.html#f51e30f058656f7f19536efc049be923">setGNREventType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#3017adf344c435005db11e8c0d8c03bd92d1c11b5acee51a4090d8c1ae57a6f0">REFRESHSCENETREE</a>);
<a name="l00317"></a>00317         ProcessEvent(gnrevent);
<a name="l00318"></a>00318 }
<a name="l00319"></a>00319 
<a name="l00323"></a><a class="code" href="../../d6/db5/class_scene.html#614d61ecdb9dbcbad7f868f9bd1e6ec5">00323</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#614d61ecdb9dbcbad7f868f9bd1e6ec5">Scene::resetSelectedAssemblies</a>()
<a name="l00324"></a>00324 {
<a name="l00325"></a>00325         list&lt;Assembly*&gt; parts = <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#ed4ea8b1f7dc109c964eb8f0c3c53626">getPartList</a>();
<a name="l00326"></a>00326 
<a name="l00327"></a>00327         <span class="keywordflow">for</span> (list&lt;Assembly*&gt;::iterator it = parts.begin(); it != parts.end(); ++it)
<a name="l00328"></a>00328         {
<a name="l00329"></a>00329                 (*it)-&gt;resetOnGround();
<a name="l00330"></a>00330         }
<a name="l00331"></a>00331 }
<a name="l00332"></a>00332 
<a name="l00336"></a><a class="code" href="../../d6/db5/class_scene.html#5600c74be3413bd9c2bf056cf5c2b1dd">00336</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#5600c74be3413bd9c2bf056cf5c2b1dd">Scene::deleteTrashAssemblies</a>()
<a name="l00337"></a>00337 {
<a name="l00338"></a>00338         list&lt;Assembly*&gt; trash = <a class="code" href="../../d6/db5/class_scene.html#3d621c528dca6465b8f461b42378a860">m_Trash</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#ed4ea8b1f7dc109c964eb8f0c3c53626">getPartList</a>();
<a name="l00339"></a>00339 
<a name="l00340"></a>00340         <span class="keywordflow">for</span> (list&lt;Assembly*&gt;::iterator it = trash.begin(); it != trash.end(); ++it)
<a name="l00341"></a>00341         {
<a name="l00342"></a>00342                 <span class="comment">//it is an original and there are some clones in the scene</span>
<a name="l00343"></a>00343                 <span class="keywordflow">if</span> ((*it)-&gt;getOrigin() == NULL &amp;&amp; <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#a441eb90c7cf5dfd3a843dda7c3c795e">findCloneOf</a>((*it)))
<a name="l00344"></a>00344                 {
<a name="l00345"></a>00345                         <span class="comment">//save original, will be killed in</span>
<a name="l00346"></a>00346                         <span class="comment">// destructor or on new room</span>
<a name="l00347"></a>00347                         <a class="code" href="../../d6/db5/class_scene.html#cd4f2edb06574753cdfe6c976c3fd53d">m_Originals</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>((*it));
<a name="l00348"></a>00348                         <a class="code" href="../../d6/db5/class_scene.html#3d621c528dca6465b8f461b42378a860">m_Trash</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#db9582f954f8764cd1431455af7fff6f">delPart</a>((*it));
<a name="l00349"></a>00349                 }
<a name="l00350"></a>00350         }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352         <span class="comment">//delete trash and create new one</span>
<a name="l00353"></a>00353         <span class="keyword">delete</span> <a class="code" href="../../d6/db5/class_scene.html#3d621c528dca6465b8f461b42378a860">m_Trash</a>;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355         <a class="code" href="../../d6/db5/class_scene.html#3d621c528dca6465b8f461b42378a860">m_Trash</a> = <span class="keyword">new</span> <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#9867f03749a40c51d1474b8d3bd04b74380df5c45e409c328af56406573c2416">IS_TRASH</a>, wxT(<span class="stringliteral">"trash"</span>));
<a name="l00356"></a>00356 
<a name="l00357"></a>00357         <span class="comment">// send event to refresh Scene-Tree</span>
<a name="l00358"></a>00358         <a class="code" href="../../d1/d0e/class_notify_event.html">NotifyEvent</a> gnrevent(wxEVT_COMMAND_GNR_NOTIFY);
<a name="l00359"></a>00359         gnrevent.<a class="code" href="../../d1/d0e/class_notify_event.html#f51e30f058656f7f19536efc049be923">setGNREventType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#3017adf344c435005db11e8c0d8c03bd92d1c11b5acee51a4090d8c1ae57a6f0">REFRESHSCENETREE</a>);
<a name="l00360"></a>00360         ProcessEvent(gnrevent);
<a name="l00361"></a>00361 }
<a name="l00362"></a>00362 
<a name="l00368"></a><a class="code" href="../../d6/db5/class_scene.html#4e030c19b81cbd09c4fe5b77bf5fa9ee">00368</a> <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* <a class="code" href="../../d6/db5/class_scene.html#4e030c19b81cbd09c4fe5b77bf5fa9ee">Scene::getOrigialFromHash</a>(<span class="keyword">const</span> wxString hash)
<a name="l00369"></a>00369 {
<a name="l00370"></a>00370         <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* original;
<a name="l00371"></a>00371 
<a name="l00372"></a>00372         <span class="comment">//first query all originals for pointer</span>
<a name="l00373"></a>00373         original = <a class="code" href="../../d6/db5/class_scene.html#cd4f2edb06574753cdfe6c976c3fd53d">m_Originals</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#ce517fe3f2489421af16176f574a7a56">getHashOriginal</a>(hash);
<a name="l00374"></a>00374 
<a name="l00375"></a>00375         <span class="keywordflow">if</span> (original != NULL)
<a name="l00376"></a>00376         {
<a name="l00377"></a>00377                 <span class="keywordflow">return</span> original;
<a name="l00378"></a>00378         }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380         <span class="comment">//second query trash for pointer</span>
<a name="l00381"></a>00381         original = <a class="code" href="../../d6/db5/class_scene.html#3d621c528dca6465b8f461b42378a860">m_Trash</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#ce517fe3f2489421af16176f574a7a56">getHashOriginal</a>(hash);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383         <span class="keywordflow">if</span> (original != NULL)
<a name="l00384"></a>00384         {
<a name="l00385"></a>00385                 <span class="keywordflow">return</span> original;
<a name="l00386"></a>00386         }
<a name="l00387"></a>00387 
<a name="l00388"></a>00388         <span class="comment">//and last query root for pointer</span>
<a name="l00389"></a>00389         original = <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#ce517fe3f2489421af16176f574a7a56">getHashOriginal</a>(hash);
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         <span class="comment">//return pointer or NULL from assembly</span>
<a name="l00392"></a>00392         <span class="keywordflow">return</span> original;
<a name="l00393"></a>00393 }
<a name="l00394"></a>00394 
<a name="l00399"></a><a class="code" href="../../d6/db5/class_scene.html#13c6fa8a3cea94036dba715ac4dbe49e">00399</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#13c6fa8a3cea94036dba715ac4dbe49e">Scene::deleteAssembly</a>(<a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* assembly)
<a name="l00400"></a>00400 {
<a name="l00401"></a>00401         <span class="comment">// delete assembly from parent</span>
<a name="l00402"></a>00402         assembly-&gt;<a class="code" href="../../d5/de3/class_assembly.html#058c470dea4bb4219b91f55845d0a1ed">getParent</a>()-&gt;<a class="code" href="../../d5/de3/class_assembly.html#db9582f954f8764cd1431455af7fff6f">delPart</a>(assembly);
<a name="l00403"></a>00403 
<a name="l00404"></a>00404         <a class="code" href="../../d6/db5/class_scene.html#3d621c528dca6465b8f461b42378a860">m_Trash</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>(assembly);
<a name="l00405"></a>00405 
<a name="l00406"></a>00406         <a class="code" href="../../d6/db5/class_scene.html#5b81137c9b7c995108175d8a24f822ae">glRefresh</a>();
<a name="l00407"></a>00407 
<a name="l00408"></a>00408         <span class="comment">// send event to refresh Scene-Tree</span>
<a name="l00409"></a>00409         <a class="code" href="../../d1/d0e/class_notify_event.html">NotifyEvent</a> gnrevent(wxEVT_COMMAND_GNR_NOTIFY);
<a name="l00410"></a>00410         gnrevent.<a class="code" href="../../d1/d0e/class_notify_event.html#f51e30f058656f7f19536efc049be923">setGNREventType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#3017adf344c435005db11e8c0d8c03bd92d1c11b5acee51a4090d8c1ae57a6f0">REFRESHSCENETREE</a>);
<a name="l00411"></a>00411         ProcessEvent(gnrevent);
<a name="l00412"></a>00412 }
<a name="l00413"></a>00413 
<a name="l00417"></a><a class="code" href="../../d6/db5/class_scene.html#94adb30b6b661dcdf107a642d78a5d42">00417</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#94adb30b6b661dcdf107a642d78a5d42">Scene::cloneSelectedAssemblies</a>()
<a name="l00418"></a>00418 {
<a name="l00419"></a>00419         list&lt;Assembly*&gt; parts = <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#ed4ea8b1f7dc109c964eb8f0c3c53626">getPartList</a>();
<a name="l00420"></a>00420 
<a name="l00421"></a>00421         <span class="keywordflow">for</span> (list&lt;Assembly*&gt;::iterator it = parts.begin(); it != parts.end(); ++it)
<a name="l00422"></a>00422         {
<a name="l00423"></a>00423                 <span class="comment">//clone assembly from selected</span>
<a name="l00424"></a>00424                 <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* a_copy = (*it)-&gt;clone();
<a name="l00425"></a>00425                 <span class="comment">//move selected to world</span>
<a name="l00426"></a>00426                 <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>((*it));
<a name="l00427"></a>00427                 <span class="comment">//remove selected</span>
<a name="l00428"></a>00428                 <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#db9582f954f8764cd1431455af7fff6f">delPart</a>((*it));
<a name="l00429"></a>00429                 <span class="comment">//copy clone in selected</span>
<a name="l00430"></a>00430                 <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>(a_copy);
<a name="l00431"></a>00431                 <span class="comment">//move assembly one width right</span>
<a name="l00432"></a>00432                 a_copy-&gt;<a class="code" href="../../d5/de3/class_assembly.html#8ede7e45c400b1290cc6cf31d24ce2b6">move</a>(<a class="code" href="../../d0/d72/class_vertex.html">Vertex</a>(a_copy-&gt;<a class="code" href="../../d5/de3/class_assembly.html#f00519c08826233f0fcba35315f8e597">getWidthMeters</a>(),0.0,0.0));
<a name="l00433"></a>00433         }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435         <span class="comment">// send event to refresh Scene-Tree</span>
<a name="l00436"></a>00436         <a class="code" href="../../d1/d0e/class_notify_event.html">NotifyEvent</a> gnrevent(wxEVT_COMMAND_GNR_NOTIFY);
<a name="l00437"></a>00437         gnrevent.<a class="code" href="../../d1/d0e/class_notify_event.html#f51e30f058656f7f19536efc049be923">setGNREventType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#3017adf344c435005db11e8c0d8c03bd92d1c11b5acee51a4090d8c1ae57a6f0">REFRESHSCENETREE</a>);
<a name="l00438"></a>00438         ProcessEvent(gnrevent);
<a name="l00439"></a>00439 }
<a name="l00440"></a>00440 
<a name="l00444"></a><a class="code" href="../../d6/db5/class_scene.html#7fce66ce263e0499779599c4571c9238">00444</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#7fce66ce263e0499779599c4571c9238">Scene::copySelectedAssemblies</a>()
<a name="l00445"></a>00445 {
<a name="l00446"></a>00446         <span class="keyword">delete</span> <a class="code" href="../../d6/db5/class_scene.html#dd9b5ce6ab56cc95c9e78301e5431913">m_Duplicator</a>;
<a name="l00447"></a>00447         <a class="code" href="../../d6/db5/class_scene.html#dd9b5ce6ab56cc95c9e78301e5431913">m_Duplicator</a> = <span class="keyword">new</span> <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#9867f03749a40c51d1474b8d3bd04b74dcf1f35ed351bbd192b6b73a95ac4d56">IS_DUPLICATOR</a>,  wxT(<span class="stringliteral">"duplicator"</span>));
<a name="l00448"></a>00448 
<a name="l00449"></a>00449         list&lt;Assembly*&gt; parts = <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#ed4ea8b1f7dc109c964eb8f0c3c53626">getPartList</a>();
<a name="l00450"></a>00450 
<a name="l00451"></a>00451         <span class="keywordflow">for</span> (list&lt;Assembly*&gt;::iterator it = parts.begin(); it != parts.end(); ++it)
<a name="l00452"></a>00452         {
<a name="l00453"></a>00453                 <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* a_copy = (*it)-&gt;clone();
<a name="l00454"></a>00454                 <a class="code" href="../../d6/db5/class_scene.html#dd9b5ce6ab56cc95c9e78301e5431913">m_Duplicator</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>(a_copy);
<a name="l00455"></a>00455         }
<a name="l00456"></a>00456 }
<a name="l00457"></a>00457 
<a name="l00461"></a><a class="code" href="../../d6/db5/class_scene.html#ded34c658cbeb426939ed8a3f3b070b8">00461</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#ded34c658cbeb426939ed8a3f3b070b8">Scene::cutSelectedAssemblies</a>()
<a name="l00462"></a>00462 {
<a name="l00463"></a>00463         <span class="keyword">delete</span> <a class="code" href="../../d6/db5/class_scene.html#dd9b5ce6ab56cc95c9e78301e5431913">m_Duplicator</a>;
<a name="l00464"></a>00464         <a class="code" href="../../d6/db5/class_scene.html#dd9b5ce6ab56cc95c9e78301e5431913">m_Duplicator</a> = <span class="keyword">new</span> <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#9867f03749a40c51d1474b8d3bd04b74dcf1f35ed351bbd192b6b73a95ac4d56">IS_DUPLICATOR</a>,  wxT(<span class="stringliteral">"duplicator"</span>));
<a name="l00465"></a>00465 
<a name="l00466"></a>00466         list&lt;Assembly*&gt; parts = <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#ed4ea8b1f7dc109c964eb8f0c3c53626">getPartList</a>();
<a name="l00467"></a>00467 
<a name="l00468"></a>00468         <span class="keywordflow">for</span> (list&lt;Assembly*&gt;::iterator it = parts.begin(); it != parts.end(); ++it)
<a name="l00469"></a>00469         {
<a name="l00470"></a>00470                 <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* a_copy = (*it)-&gt;clone();
<a name="l00471"></a>00471                 <a class="code" href="../../d6/db5/class_scene.html#dd9b5ce6ab56cc95c9e78301e5431913">m_Duplicator</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>(a_copy);
<a name="l00472"></a>00472                 <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#db9582f954f8764cd1431455af7fff6f">delPart</a>((*it));
<a name="l00473"></a>00473         }
<a name="l00474"></a>00474 }
<a name="l00475"></a>00475 
<a name="l00479"></a><a class="code" href="../../d6/db5/class_scene.html#5d485458c29ad4bed4110d40b1cd445d">00479</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#5d485458c29ad4bed4110d40b1cd445d">Scene::insertCopiedAssemblies</a>()
<a name="l00480"></a>00480 {
<a name="l00481"></a>00481         list&lt;Assembly*&gt; parts = <a class="code" href="../../d6/db5/class_scene.html#dd9b5ce6ab56cc95c9e78301e5431913">m_Duplicator</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#ed4ea8b1f7dc109c964eb8f0c3c53626">getPartList</a>();
<a name="l00482"></a>00482 
<a name="l00483"></a>00483         <span class="keywordflow">for</span> (list&lt;Assembly*&gt;::iterator it = parts.begin(); it != parts.end(); ++it)
<a name="l00484"></a>00484         {
<a name="l00485"></a>00485                 <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* a_copy = (*it)-&gt;clone();
<a name="l00486"></a>00486                 <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>(a_copy);
<a name="l00487"></a>00487         }
<a name="l00488"></a>00488 
<a name="l00489"></a>00489         <span class="comment">// send event to refresh Scene-Tree</span>
<a name="l00490"></a>00490         <a class="code" href="../../d1/d0e/class_notify_event.html">NotifyEvent</a> gnrevent(wxEVT_COMMAND_GNR_NOTIFY);
<a name="l00491"></a>00491         gnrevent.<a class="code" href="../../d1/d0e/class_notify_event.html#f51e30f058656f7f19536efc049be923">setGNREventType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#3017adf344c435005db11e8c0d8c03bd92d1c11b5acee51a4090d8c1ae57a6f0">REFRESHSCENETREE</a>);
<a name="l00492"></a>00492         ProcessEvent(gnrevent);
<a name="l00493"></a>00493 }
<a name="l00494"></a>00494 
<a name="l00499"></a><a class="code" href="../../d6/db5/class_scene.html#ac95ffea4bdf71e9cf9e985b3a74348d">00499</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#ac95ffea4bdf71e9cf9e985b3a74348d">Scene::drawLine</a>(<a class="code" href="../../db/d16/class_line_draw_event.html">LineDrawEvent</a>&amp; event)
<a name="l00500"></a>00500 {
<a name="l00501"></a>00501         <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a> = <a class="code" href="../../d6/db5/class_scene.html#6563995309e1fb25d5ce58ab92e441db">m_Canvas2D</a>;
<a name="l00502"></a>00502         <a class="code" href="../../d6/db5/class_scene.html#2ee60d9e092d0723003a4e5fff434af9">m_GLCAM</a> = <a class="code" href="../../d6/db5/class_scene.html#aa26c5e3420d61bc3d0018ce62bad9c9">m_GLCamera2D</a>;
<a name="l00503"></a>00503 
<a name="l00504"></a>00504         <span class="comment">//prepare and draw 2D top view of room</span>
<a name="l00505"></a>00505         <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#68ae53195e0e85373c2914c0f714b1ef">prepareDraw</a>();
<a name="l00506"></a>00506 
<a name="l00507"></a>00507         <span class="comment">//set camera for scene</span>
<a name="l00508"></a>00508         <a class="code" href="../../d6/db5/class_scene.html#2ee60d9e092d0723003a4e5fff434af9">m_GLCAM</a>-&gt;<a class="code" href="../../da/d43/class_g_l_camera.html#23734ccf4e8be643e3c6b7bc3d2626c8">render</a>();
<a name="l00509"></a>00509 
<a name="l00510"></a>00510         <span class="comment">/*NOW PREPARE THE PIXELBUFFER AND DRAW VIRTUAL FLOOR FOR CASTING SHADOWS*/</span>
<a name="l00511"></a>00511         <span class="keywordflow">if</span> (<a class="code" href="../../d6/db5/class_scene.html#e621a1c2ded92d3625192476331df7c0">m_shadows</a>)
<a name="l00512"></a>00512         {
<a name="l00513"></a>00513                 <span class="comment">//initialize only light source</span>
<a name="l00514"></a>00514                 <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#0a217a6dac41d7d16cb51bc2880b5e46">initLights</a>();
<a name="l00515"></a>00515 
<a name="l00516"></a>00516                 <span class="comment">//prepare pixelbuffer for shadows</span>
<a name="l00517"></a>00517                 <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#c791e43686e1f7139ecccf8019a83db9">preparePixelBuffer</a>();
<a name="l00518"></a>00518 
<a name="l00519"></a>00519                 <span class="comment">//draw invisible floor for shadow projection</span>
<a name="l00520"></a>00520                 <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#4e773fd347676178e60015ddd22768ad">drawBaseFloor</a>(0.0, 0.0, 0.0, <a class="code" href="../../d2/d46/_global_define_8h.html#7cacec5964b86e10fde43643414e2677">DEFAULT_FLOOR_SIZE</a>);
<a name="l00521"></a>00521 
<a name="l00522"></a>00522                 <span class="comment">//turn the color and depth buffers back on</span>
<a name="l00523"></a>00523                 <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#049a8ed970f34623a8845e19ae42ff5e">endPixelBuffer</a>();
<a name="l00524"></a>00524 
<a name="l00525"></a>00525                 <span class="comment">/*NOW CAST THE SHADOWS ON THE FLOOR AND KEEP IN PIXELBUFFER*/</span>
<a name="l00526"></a>00526 
<a name="l00527"></a>00527                 <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#4e773fd347676178e60015ddd22768ad">drawBaseFloor</a>(0.0, 0.0, 0.0, <a class="code" href="../../d2/d46/_global_define_8h.html#7cacec5964b86e10fde43643414e2677">DEFAULT_FLOOR_SIZE</a>);
<a name="l00528"></a>00528 
<a name="l00529"></a>00529                 <span class="comment">//draw all shadows of objects</span>
<a name="l00530"></a>00530                 glPushMatrix();
<a name="l00531"></a>00531                 {
<a name="l00532"></a>00532                         <span class="comment">//turn shadows on</span>
<a name="l00533"></a>00533                         <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#391b3812152e7cd5b5e6727b81f04905">shadowColorOn</a>();
<a name="l00534"></a>00534                         <span class="comment">//load shadow projection matrix</span>
<a name="l00535"></a>00535                         <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#a22fa22319bb80b056e1abf991cad0d7">loadShadowMatrix</a>();
<a name="l00536"></a>00536                         <span class="comment">//draw shadows on prepainted floor (1)</span>
<a name="l00537"></a>00537                         glPushMatrix();
<a name="l00538"></a>00538                         {
<a name="l00539"></a>00539                                 <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#af5da3f7a8447c83399e0b58596450e1">drawShadow</a>();
<a name="l00540"></a>00540                         }
<a name="l00541"></a>00541                         glPopMatrix();
<a name="l00542"></a>00542                         <span class="comment">//turn off shadows</span>
<a name="l00543"></a>00543                         <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#77c335465036944eda1a962c0ccd9a5d">shadowColorOff</a>();
<a name="l00544"></a>00544                 }
<a name="l00545"></a>00545                 glPopMatrix();
<a name="l00546"></a>00546         }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548         <span class="comment">/*NOW DRAW ALL OBJECTS WITHOUT SHADOWS AND BLEND WITH SHADOWS*/</span>
<a name="l00549"></a>00549 
<a name="l00550"></a>00550         <span class="comment">//draw real objects</span>
<a name="l00551"></a>00551         glPushMatrix();
<a name="l00552"></a>00552         {
<a name="l00553"></a>00553                 glPushMatrix();
<a name="l00554"></a>00554                 {
<a name="l00555"></a>00555                         <span class="comment">//draw line from start- to end-point</span>
<a name="l00556"></a>00556                         <span class="keywordtype">float</span> lineColor[4] = {1.0, 0.0, 0.0, 0.0};
<a name="l00557"></a>00557                         glMaterialfv(GL_FRONT, GL_EMISSION, lineColor);
<a name="l00558"></a>00558                         glMaterialfv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, lineColor);
<a name="l00559"></a>00559 
<a name="l00560"></a>00560                         <span class="comment">//should be like the default wallsize</span>
<a name="l00561"></a>00561                         glLineWidth(100.0/(<span class="keywordtype">float</span>)<a class="code" href="../../d6/db5/class_scene.html#aa26c5e3420d61bc3d0018ce62bad9c9">m_GLCamera2D</a>-&gt;<a class="code" href="../../da/d43/class_g_l_camera.html#8a3c75a09e27547204bcb45aca580df5">getDistance</a>());
<a name="l00562"></a>00562 
<a name="l00563"></a>00563                         <span class="comment">//draw line from start to end</span>
<a name="l00564"></a>00564                         glBegin(GL_LINES);
<a name="l00565"></a>00565                         {
<a name="l00566"></a>00566                                 glVertex3f(event.<a class="code" href="../../db/d16/class_line_draw_event.html#4bb98b0ecdedad0f32ea88a0f7d72a3f">getStartPoint</a>().<a class="code" href="../../d0/d72/class_vertex.html#5052ff1eaa3994c79c8b693884127428">getX</a>(), <span class="keyword">event</span>.getStartPoint().getY(), <span class="keyword">event</span>.getStartPoint().getZ());
<a name="l00567"></a>00567                                 glVertex3f(event.<a class="code" href="../../db/d16/class_line_draw_event.html#c49d8da3ba1057c7ccbf378c38305919">getEndPoint</a>().<a class="code" href="../../d0/d72/class_vertex.html#5052ff1eaa3994c79c8b693884127428">getX</a>(), <span class="keyword">event</span>.getEndPoint().getY(), <span class="keyword">event</span>.getEndPoint().getZ());
<a name="l00568"></a>00568                         }
<a name="l00569"></a>00569                         glEnd();
<a name="l00570"></a>00570 
<a name="l00571"></a>00571                         <span class="comment">//turn on lights</span>
<a name="l00572"></a>00572                         <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#0a217a6dac41d7d16cb51bc2880b5e46">initLights</a>();
<a name="l00573"></a>00573 
<a name="l00574"></a>00574                         <span class="comment">//if shadows disabled draw floor again</span>
<a name="l00575"></a>00575                         <span class="keywordflow">if</span> (! <a class="code" href="../../d6/db5/class_scene.html#e621a1c2ded92d3625192476331df7c0">m_shadows</a>)
<a name="l00576"></a>00576                         {
<a name="l00577"></a>00577                                 <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#4e773fd347676178e60015ddd22768ad">drawBaseFloor</a>(0.0, 0.0, 0.0, <a class="code" href="../../d2/d46/_global_define_8h.html#7cacec5964b86e10fde43643414e2677">DEFAULT_FLOOR_SIZE</a>);
<a name="l00578"></a>00578                         }
<a name="l00579"></a>00579 
<a name="l00580"></a>00580                         <span class="comment">//draw world</span>
<a name="l00581"></a>00581                         <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#c9d3e547dd21a926b9f152bd42b01418">draw</a>();
<a name="l00582"></a>00582                 }
<a name="l00583"></a>00583                 glPopMatrix();
<a name="l00584"></a>00584         }
<a name="l00585"></a>00585         glPopMatrix();
<a name="l00586"></a>00586 
<a name="l00587"></a>00587         <span class="comment">//put output to screen</span>
<a name="l00588"></a>00588         <a class="code" href="../../d6/db5/class_scene.html#e2ef43dfd384fde4aa0cc3ef2e1c8fd1">m_GLOUT</a>-&gt;<a class="code" href="../../d5/d7b/class_g_l_canvas.html#58d78457618b3e3c0120ab9a7fd8addb">endDraw</a>();
<a name="l00589"></a>00589 
<a name="l00590"></a>00590         <span class="comment">// calculate length of the line</span>
<a name="l00591"></a>00591         <span class="keywordtype">float</span> x = <span class="keyword">event</span>.getEndPoint().getX() - <span class="keyword">event</span>.getStartPoint().getX();
<a name="l00592"></a>00592         <span class="keywordtype">float</span> y = <span class="keyword">event</span>.getEndPoint().getY() - <span class="keyword">event</span>.getStartPoint().getY();
<a name="l00593"></a>00593         <span class="keywordtype">float</span> z = <span class="keyword">event</span>.getEndPoint().getZ() - <span class="keyword">event</span>.getStartPoint().getZ();
<a name="l00594"></a>00594         <a class="code" href="../../d0/d72/class_vertex.html">Vertex</a> myvec(x, y, z);
<a name="l00595"></a>00595         <span class="keywordtype">int</span> length = (int)floor(1000.0 * myvec.<a class="code" href="../../d0/d72/class_vertex.html#194518d7172844246326629b192e9773">length</a>());
<a name="l00596"></a>00596 
<a name="l00597"></a>00597         <span class="comment">//create string for statusbar</span>
<a name="l00598"></a>00598         wxString str;
<a name="l00599"></a>00599         str &lt;&lt; wxT(<span class="stringliteral">"Wandlnge: "</span>) &lt;&lt; length &lt;&lt; wxT(<span class="stringliteral">" mm"</span>);
<a name="l00600"></a>00600 
<a name="l00601"></a>00601         <span class="comment">// send event to display length</span>
<a name="l00602"></a>00602         <a class="code" href="../../d1/d0e/class_notify_event.html">NotifyEvent</a> gnrevent(wxEVT_COMMAND_GNR_NOTIFY);
<a name="l00603"></a>00603         gnrevent.<a class="code" href="../../d1/d0e/class_notify_event.html#f51e30f058656f7f19536efc049be923">setGNREventType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#3017adf344c435005db11e8c0d8c03bd1f04aa4ad716c63a26002a569436f4b8">DISPLAYLENGTH</a>);
<a name="l00604"></a>00604         gnrevent.SetString(str);
<a name="l00605"></a>00605         ProcessEvent(gnrevent);
<a name="l00606"></a>00606 }
<a name="l00607"></a>00607 
<a name="l00611"></a><a class="code" href="../../d6/db5/class_scene.html#75e7779708f1a2b27c63941fc0f6d3d6">00611</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#75e7779708f1a2b27c63941fc0f6d3d6">Scene::hideSelectedAssemblies</a>()
<a name="l00612"></a>00612 {
<a name="l00613"></a>00613         list&lt;Assembly*&gt; parts = <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#ed4ea8b1f7dc109c964eb8f0c3c53626">getPartList</a>();
<a name="l00614"></a>00614 
<a name="l00615"></a>00615         <span class="keywordflow">for</span> (list&lt;Assembly*&gt;::iterator it = parts.begin(); it != parts.end(); ++it)
<a name="l00616"></a>00616         {
<a name="l00617"></a>00617                 <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>((*it));
<a name="l00618"></a>00618                 <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#db9582f954f8764cd1431455af7fff6f">delPart</a>((*it));
<a name="l00619"></a>00619                 (*it)-&gt;setVisible(<span class="keyword">false</span>);
<a name="l00620"></a>00620         }
<a name="l00621"></a>00621 
<a name="l00622"></a>00622         <span class="comment">// send event to refresh Scene-Tree</span>
<a name="l00623"></a>00623         <a class="code" href="../../d1/d0e/class_notify_event.html">NotifyEvent</a> gnrevent(wxEVT_COMMAND_GNR_NOTIFY);
<a name="l00624"></a>00624         gnrevent.<a class="code" href="../../d1/d0e/class_notify_event.html#f51e30f058656f7f19536efc049be923">setGNREventType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#3017adf344c435005db11e8c0d8c03bd92d1c11b5acee51a4090d8c1ae57a6f0">REFRESHSCENETREE</a>);
<a name="l00625"></a>00625         ProcessEvent(gnrevent);
<a name="l00626"></a>00626 }
<a name="l00627"></a>00627 
<a name="l00631"></a><a class="code" href="../../d6/db5/class_scene.html#25bd4ad6562470b9c059a52096eeaec5">00631</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#25bd4ad6562470b9c059a52096eeaec5">Scene::groupSelectedAssemblies</a>()
<a name="l00632"></a>00632 {
<a name="l00633"></a>00633         list&lt;Assembly*&gt; parts = <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#ed4ea8b1f7dc109c964eb8f0c3c53626">getPartList</a>();
<a name="l00634"></a>00634 
<a name="l00635"></a>00635         <span class="keywordflow">if</span> (parts.size() &lt; 1)
<a name="l00636"></a>00636         {
<a name="l00637"></a>00637                 <span class="comment">//no or only one part, don't waste time</span>
<a name="l00638"></a>00638                 <span class="keywordflow">return</span>;
<a name="l00639"></a>00639         }
<a name="l00640"></a>00640 
<a name="l00641"></a>00641         <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* group = <span class="keyword">new</span> <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#9867f03749a40c51d1474b8d3bd04b74f61032f5b603f113d422d380b95ad7be">IS_GROUP</a>, wxT(<span class="stringliteral">"Gruppe"</span>));
<a name="l00642"></a>00642 
<a name="l00643"></a>00643         <span class="keywordtype">float</span> min[3] = {<a class="code" href="../../d2/d46/_global_define_8h.html#0cbfb08bf51873542f5b9e393b9ec7f3">SIZE_MAXIMUM_VALUE</a>,<a class="code" href="../../d2/d46/_global_define_8h.html#0cbfb08bf51873542f5b9e393b9ec7f3">SIZE_MAXIMUM_VALUE</a>,SIZE_MAXIMUM_VALUE};
<a name="l00644"></a>00644         <span class="keywordtype">float</span> max[3] = {-<a class="code" href="../../d2/d46/_global_define_8h.html#0cbfb08bf51873542f5b9e393b9ec7f3">SIZE_MAXIMUM_VALUE</a>,-<a class="code" href="../../d2/d46/_global_define_8h.html#0cbfb08bf51873542f5b9e393b9ec7f3">SIZE_MAXIMUM_VALUE</a>,-SIZE_MAXIMUM_VALUE};
<a name="l00645"></a>00645 
<a name="l00646"></a>00646         <span class="comment">//first pass to get maximum cube and new center of group</span>
<a name="l00647"></a>00647         <span class="keywordflow">for</span> (list&lt;Assembly*&gt;::iterator it = parts.begin(); it != parts.end(); ++it)
<a name="l00648"></a>00648         {
<a name="l00649"></a>00649                 <span class="comment">//kill possible empty groups in container</span>
<a name="l00650"></a>00650                 <span class="keywordflow">if</span> ((*it)-&gt;getPartList().size() &lt; 1)
<a name="l00651"></a>00651                 {
<a name="l00652"></a>00652                         <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#db9582f954f8764cd1431455af7fff6f">delPart</a>(*it);
<a name="l00653"></a>00653                         <span class="keywordflow">continue</span>;
<a name="l00654"></a>00654                 }
<a name="l00655"></a>00655                 <a class="code" href="../../d6/db5/class_scene.html#6b5c495f949bb265b4d50cc4e21c3bb7">minmax</a>(min[0], max[0], (*it)-&gt;getX());
<a name="l00656"></a>00656                 <a class="code" href="../../d6/db5/class_scene.html#6b5c495f949bb265b4d50cc4e21c3bb7">minmax</a>(min[1], max[1], (*it)-&gt;getY());
<a name="l00657"></a>00657                 <a class="code" href="../../d6/db5/class_scene.html#6b5c495f949bb265b4d50cc4e21c3bb7">minmax</a>(min[2], max[2], (*it)-&gt;getZ());
<a name="l00658"></a>00658         }
<a name="l00659"></a>00659 
<a name="l00660"></a>00660         <span class="comment">//build new center as vertex for better calculation</span>
<a name="l00661"></a>00661         <a class="code" href="../../d0/d72/class_vertex.html">Vertex</a> new_center((max[0]+min[0])/2.0, (max[1]+min[1])/2.0, (max[2]+min[2])/2.0);
<a name="l00662"></a>00662 
<a name="l00663"></a>00663         <span class="comment">//move group center to new center</span>
<a name="l00664"></a>00664         group-&gt;<a class="code" href="../../d5/de3/class_assembly.html#9f9155319996ee24309b53072ea3fca2">setCenterVertex</a>(new_center);
<a name="l00665"></a>00665         group-&gt;<a class="code" href="../../d5/de3/class_assembly.html#7576e9af9149611c7e9f22d6b3b6e739">setHeight</a>((max[1]+min[1]));
<a name="l00666"></a>00666         <span class="comment">//store obj center as vertex</span>
<a name="l00667"></a>00667         <a class="code" href="../../d0/d72/class_vertex.html">Vertex</a> obj_center;
<a name="l00668"></a>00668 
<a name="l00669"></a>00669         <span class="comment">//put all assemblies in the selected container</span>
<a name="l00670"></a>00670         <span class="keywordflow">for</span> (list&lt;Assembly*&gt;::iterator it = parts.begin(); it != parts.end(); ++it)
<a name="l00671"></a>00671         {
<a name="l00672"></a>00672                 <span class="comment">//store old center</span>
<a name="l00673"></a>00673                 obj_center = (*it)-&gt;getCenterVertex();
<a name="l00674"></a>00674 
<a name="l00675"></a>00675                 <span class="comment">//add part to new group and remove from selection</span>
<a name="l00676"></a>00676                 group-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>((*it));
<a name="l00677"></a>00677                 <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#db9582f954f8764cd1431455af7fff6f">delPart</a>((*it));
<a name="l00678"></a>00678 
<a name="l00679"></a>00679                 <span class="comment">//modify center relative to new center</span>
<a name="l00680"></a>00680                 obj_center = obj_center - new_center;
<a name="l00681"></a>00681                 (*it)-&gt;setCenterVertex(obj_center);
<a name="l00682"></a>00682         }
<a name="l00683"></a>00683 
<a name="l00684"></a>00684         <span class="comment">//put new group in the world</span>
<a name="l00685"></a>00685         <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>(group);
<a name="l00686"></a>00686 
<a name="l00687"></a>00687         <span class="comment">// send event to refresh Scene-Tree</span>
<a name="l00688"></a>00688         <a class="code" href="../../d1/d0e/class_notify_event.html">NotifyEvent</a> gnrevent(wxEVT_COMMAND_GNR_NOTIFY);
<a name="l00689"></a>00689         gnrevent.<a class="code" href="../../d1/d0e/class_notify_event.html#f51e30f058656f7f19536efc049be923">setGNREventType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#3017adf344c435005db11e8c0d8c03bd92d1c11b5acee51a4090d8c1ae57a6f0">REFRESHSCENETREE</a>);
<a name="l00690"></a>00690         ProcessEvent(gnrevent);
<a name="l00691"></a>00691 }
<a name="l00692"></a>00692 
<a name="l00696"></a><a class="code" href="../../d6/db5/class_scene.html#90452b898b5f166f9eee9bfc0893dab9">00696</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#90452b898b5f166f9eee9bfc0893dab9">Scene::ungroupSelectedAssemblies</a>()
<a name="l00697"></a>00697 {
<a name="l00698"></a>00698         list&lt;Assembly*&gt; sel_parts = <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#ed4ea8b1f7dc109c964eb8f0c3c53626">getPartList</a>();
<a name="l00699"></a>00699         list&lt;Assembly*&gt; grp_parts;
<a name="l00700"></a>00700 
<a name="l00701"></a>00701         <span class="keywordflow">if</span> (sel_parts.size() &lt; 1)
<a name="l00702"></a>00702         {
<a name="l00703"></a>00703                 <span class="comment">//no or only one part, don't waste time</span>
<a name="l00704"></a>00704                 <span class="keywordflow">return</span>;
<a name="l00705"></a>00705         }
<a name="l00706"></a>00706 
<a name="l00707"></a>00707         <a class="code" href="../../d0/d72/class_vertex.html">Vertex</a> grp_center, grp_rotate, obj_center, ptr_object, ptr_rotate;
<a name="l00708"></a>00708 
<a name="l00709"></a>00709         <span class="comment">//find all groups and free them</span>
<a name="l00710"></a>00710         <span class="keywordflow">for</span> (list&lt;Assembly*&gt;::iterator it = sel_parts.begin(); it != sel_parts.end(); ++it)
<a name="l00711"></a>00711         {
<a name="l00712"></a>00712                 <span class="comment">//only for groups in the selected container</span>
<a name="l00713"></a>00713                 <span class="keywordflow">if</span> ((*it)-&gt;isType(<a class="code" href="../../dd/dd8/_enum_8h.html#9867f03749a40c51d1474b8d3bd04b74f61032f5b603f113d422d380b95ad7be">IS_GROUP</a>))
<a name="l00714"></a>00714                 {
<a name="l00715"></a>00715                         <span class="comment">//get partlist iterator</span>
<a name="l00716"></a>00716                         grp_parts  = (*it)-&gt;getPartList();
<a name="l00717"></a>00717                         <span class="comment">//save center of group</span>
<a name="l00718"></a>00718                         grp_center = (*it)-&gt;getCenterVertex();
<a name="l00719"></a>00719                         <span class="comment">//save old rotation of whole group</span>
<a name="l00720"></a>00720                         grp_rotate = (*it)-&gt;getRotateVertex();
<a name="l00721"></a>00721 
<a name="l00722"></a>00722                         <span class="comment">//correct position of all group members</span>
<a name="l00723"></a>00723                         <span class="keywordflow">for</span> (list&lt;Assembly*&gt;::iterator child_it = grp_parts.begin(); child_it != grp_parts.end(); ++child_it)
<a name="l00724"></a>00724                         {
<a name="l00725"></a>00725                                 <span class="comment">//move assembly from group to IS_SELECTED in (0|0|0)</span>
<a name="l00726"></a>00726                                 <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>((*child_it));
<a name="l00727"></a>00727                                 (*it)-&gt;delPart((*child_it));
<a name="l00728"></a>00728 
<a name="l00729"></a>00729                                 <span class="comment">//save old relative position of child from group center</span>
<a name="l00730"></a>00730                                 ptr_object = (*child_it)-&gt;getCenterVertex();
<a name="l00731"></a>00731                                 ptr_rotate = (*child_it)-&gt;getRotateVertex();
<a name="l00732"></a>00732 
<a name="l00733"></a>00733                                 <span class="comment">//restore rotation from group to child around center</span>
<a name="l00734"></a>00734                                 ptr_object.<a class="code" href="../../d0/d72/class_vertex.html#40a9d8a482417b54f069af45dd27370c">rotate</a>(grp_rotate);
<a name="l00735"></a>00735 
<a name="l00736"></a>00736                                 <span class="comment">//calculate new position of child relative to (0|0|0)</span>
<a name="l00737"></a>00737                                 obj_center = ptr_object + grp_center;
<a name="l00738"></a>00738 
<a name="l00739"></a>00739                                 <span class="comment">//rotate child in same way as group and set new center</span>
<a name="l00740"></a>00740                                 (*child_it)-&gt;setRotateVertex(grp_rotate + ptr_rotate);
<a name="l00741"></a>00741                                 (*child_it)-&gt;setCenterVertex(obj_center);
<a name="l00742"></a>00742                         }
<a name="l00743"></a>00743                         <span class="comment">//remove group container from his parent</span>
<a name="l00744"></a>00744                         <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#db9582f954f8764cd1431455af7fff6f">delPart</a>(*it);
<a name="l00745"></a>00745                 }
<a name="l00746"></a>00746         }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748         <span class="comment">// send event to refresh Scene-Tree</span>
<a name="l00749"></a>00749         <a class="code" href="../../d1/d0e/class_notify_event.html">NotifyEvent</a> gnrevent(wxEVT_COMMAND_GNR_NOTIFY);
<a name="l00750"></a>00750         gnrevent.<a class="code" href="../../d1/d0e/class_notify_event.html#f51e30f058656f7f19536efc049be923">setGNREventType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#3017adf344c435005db11e8c0d8c03bd92d1c11b5acee51a4090d8c1ae57a6f0">REFRESHSCENETREE</a>);
<a name="l00751"></a>00751         ProcessEvent(gnrevent);
<a name="l00752"></a>00752 }
<a name="l00753"></a>00753 
<a name="l00758"></a><a class="code" href="../../d6/db5/class_scene.html#ca172dd29a5b1bb1580cc0e85bbc5164">00758</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#ca172dd29a5b1bb1580cc0e85bbc5164">Scene::restoreAssembly</a>(<a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* assembly)
<a name="l00759"></a>00759 {
<a name="l00760"></a>00760         <span class="keywordflow">if</span> (assembly != NULL)
<a name="l00761"></a>00761         {
<a name="l00762"></a>00762                 <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>(assembly);
<a name="l00763"></a>00763                 <a class="code" href="../../d6/db5/class_scene.html#3d621c528dca6465b8f461b42378a860">m_Trash</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#db9582f954f8764cd1431455af7fff6f">delPart</a>(assembly);
<a name="l00764"></a>00764         }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766         <a class="code" href="../../d6/db5/class_scene.html#5b81137c9b7c995108175d8a24f822ae">glRefresh</a>();
<a name="l00767"></a>00767 
<a name="l00768"></a>00768         <span class="comment">// send event to refresh Scene-Tree</span>
<a name="l00769"></a>00769         <a class="code" href="../../d1/d0e/class_notify_event.html">NotifyEvent</a> gnrevent(wxEVT_COMMAND_GNR_NOTIFY);
<a name="l00770"></a>00770         gnrevent.<a class="code" href="../../d1/d0e/class_notify_event.html#f51e30f058656f7f19536efc049be923">setGNREventType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#3017adf344c435005db11e8c0d8c03bd92d1c11b5acee51a4090d8c1ae57a6f0">REFRESHSCENETREE</a>);
<a name="l00771"></a>00771         ProcessEvent(gnrevent);
<a name="l00772"></a>00772 }
<a name="l00773"></a>00773 
<a name="l00778"></a><a class="code" href="../../d6/db5/class_scene.html#1cf180915979dd477654e96fc76755b7">00778</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#1cf180915979dd477654e96fc76755b7">Scene::showAssembly</a>(<a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* assembly)
<a name="l00779"></a>00779 {
<a name="l00780"></a>00780         assembly-&gt;<a class="code" href="../../d5/de3/class_assembly.html#29396095e0edb6d35adc1f80f9c1e0a8">setVisible</a>(<span class="keyword">true</span>);
<a name="l00781"></a>00781 
<a name="l00782"></a>00782         <span class="comment">// redraw scene</span>
<a name="l00783"></a>00783         <a class="code" href="../../d6/db5/class_scene.html#5b81137c9b7c995108175d8a24f822ae">glRefresh</a>();
<a name="l00784"></a>00784 
<a name="l00785"></a>00785         <span class="comment">// send event to refresh Scene-Tree</span>
<a name="l00786"></a>00786         <a class="code" href="../../d1/d0e/class_notify_event.html">NotifyEvent</a> gnrevent(wxEVT_COMMAND_GNR_NOTIFY);
<a name="l00787"></a>00787         gnrevent.<a class="code" href="../../d1/d0e/class_notify_event.html#f51e30f058656f7f19536efc049be923">setGNREventType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#3017adf344c435005db11e8c0d8c03bd92d1c11b5acee51a4090d8c1ae57a6f0">REFRESHSCENETREE</a>);
<a name="l00788"></a>00788         ProcessEvent(gnrevent);
<a name="l00789"></a>00789 }
<a name="l00790"></a>00790 
<a name="l00795"></a><a class="code" href="../../d6/db5/class_scene.html#9a010b9864607b15db5c92ae4764788b">00795</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#9a010b9864607b15db5c92ae4764788b">Scene::hideAssembly</a>(<a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* assembly)
<a name="l00796"></a>00796 {
<a name="l00797"></a>00797         assembly-&gt;<a class="code" href="../../d5/de3/class_assembly.html#29396095e0edb6d35adc1f80f9c1e0a8">setVisible</a>(<span class="keyword">false</span>);
<a name="l00798"></a>00798 
<a name="l00799"></a>00799         <span class="comment">// redraw scene</span>
<a name="l00800"></a>00800         <a class="code" href="../../d6/db5/class_scene.html#5b81137c9b7c995108175d8a24f822ae">glRefresh</a>();
<a name="l00801"></a>00801 
<a name="l00802"></a>00802         <span class="comment">// send event to refresh Scene-Tree</span>
<a name="l00803"></a>00803         <a class="code" href="../../d1/d0e/class_notify_event.html">NotifyEvent</a> gnrevent(wxEVT_COMMAND_GNR_NOTIFY);
<a name="l00804"></a>00804         gnrevent.<a class="code" href="../../d1/d0e/class_notify_event.html#f51e30f058656f7f19536efc049be923">setGNREventType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#3017adf344c435005db11e8c0d8c03bd92d1c11b5acee51a4090d8c1ae57a6f0">REFRESHSCENETREE</a>);
<a name="l00805"></a>00805         ProcessEvent(gnrevent);
<a name="l00806"></a>00806 }
<a name="l00807"></a>00807 
<a name="l00812"></a><a class="code" href="../../d6/db5/class_scene.html#7815a58ce8043a463095199f1a2f7331">00812</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#7815a58ce8043a463095199f1a2f7331">Scene::selectAssembly</a>(<a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* assembly)
<a name="l00813"></a>00813 {
<a name="l00814"></a>00814         <span class="keywordflow">if</span> (assembly != NULL &amp;&amp; assembly-&gt;<a class="code" href="../../d5/de3/class_assembly.html#058c470dea4bb4219b91f55845d0a1ed">getParent</a>() != NULL)
<a name="l00815"></a>00815         {
<a name="l00816"></a>00816                 <span class="comment">//if parent of assembly is group, highlight</span>
<a name="l00817"></a>00817                 <span class="keywordflow">if</span> (! assembly-&gt;<a class="code" href="../../d5/de3/class_assembly.html#058c470dea4bb4219b91f55845d0a1ed">getParent</a>()-&gt;<a class="code" href="../../d5/de3/class_assembly.html#146464ddfbfb9f65e6ef05e6fec12729">isType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#9867f03749a40c51d1474b8d3bd04b74366f54957940b07abbbc005dd696adee">IS_SELECTED</a>))
<a name="l00818"></a>00818                 {
<a name="l00819"></a>00819                         <span class="comment">//move assembly in selected container</span>
<a name="l00820"></a>00820                         <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>(assembly);
<a name="l00821"></a>00821                         <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#db9582f954f8764cd1431455af7fff6f">delPart</a>(assembly);
<a name="l00822"></a>00822                 }
<a name="l00823"></a>00823                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (assembly-&gt;<a class="code" href="../../d5/de3/class_assembly.html#058c470dea4bb4219b91f55845d0a1ed">getParent</a>()-&gt;<a class="code" href="../../d5/de3/class_assembly.html#146464ddfbfb9f65e6ef05e6fec12729">isType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#9867f03749a40c51d1474b8d3bd04b74366f54957940b07abbbc005dd696adee">IS_SELECTED</a>))
<a name="l00824"></a>00824                 {
<a name="l00825"></a>00825                         <span class="comment">//move assembly in root</span>
<a name="l00826"></a>00826                         <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>(assembly);
<a name="l00827"></a>00827                         <a class="code" href="../../d6/db5/class_scene.html#40dc8ec67fc5029c6fff5def50555060">m_Selected</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#db9582f954f8764cd1431455af7fff6f">delPart</a>(assembly);
<a name="l00828"></a>00828                 }
<a name="l00829"></a>00829                 <span class="comment">//repaint cause of box on floor</span>
<a name="l00830"></a>00830                 <a class="code" href="../../d6/db5/class_scene.html#5b81137c9b7c995108175d8a24f822ae">glRefresh</a>();
<a name="l00831"></a>00831         }
<a name="l00832"></a>00832 
<a name="l00833"></a>00833         <span class="comment">// send event to refresh Scene-Tree</span>
<a name="l00834"></a>00834         <a class="code" href="../../d1/d0e/class_notify_event.html">NotifyEvent</a> gnrevent(wxEVT_COMMAND_GNR_NOTIFY);
<a name="l00835"></a>00835         gnrevent.<a class="code" href="../../d1/d0e/class_notify_event.html#f51e30f058656f7f19536efc049be923">setGNREventType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#3017adf344c435005db11e8c0d8c03bd92d1c11b5acee51a4090d8c1ae57a6f0">REFRESHSCENETREE</a>);
<a name="l00836"></a>00836         ProcessEvent(gnrevent);
<a name="l00837"></a>00837 }
<a name="l00838"></a>00838 
<a name="l00845"></a><a class="code" href="../../d6/db5/class_scene.html#6b5c495f949bb265b4d50cc4e21c3bb7">00845</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#6b5c495f949bb265b4d50cc4e21c3bb7">Scene::minmax</a>(<span class="keywordtype">float</span>&amp; min,<span class="keywordtype">float</span>&amp; max,<span class="keywordtype">float</span> value)
<a name="l00846"></a>00846 {
<a name="l00847"></a>00847         <span class="keywordflow">if</span> (max &lt; value)
<a name="l00848"></a>00848         {
<a name="l00849"></a>00849                 max = value;
<a name="l00850"></a>00850         }
<a name="l00851"></a>00851         <span class="keywordflow">if</span> (min &gt; value)
<a name="l00852"></a>00852         {
<a name="l00853"></a>00853                 min = value;
<a name="l00854"></a>00854         }
<a name="l00855"></a>00855 }
<a name="l00856"></a>00856 
<a name="l00861"></a><a class="code" href="../../d6/db5/class_scene.html#9135a73ff87c44f77ac667aafc68bf61">00861</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#9135a73ff87c44f77ac667aafc68bf61">Scene::insertAssembly</a>(<a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* assembly)
<a name="l00862"></a>00862 {
<a name="l00863"></a>00863         <span class="comment">//put new assembly on ground</span>
<a name="l00864"></a>00864         assembly-&gt;<a class="code" href="../../d5/de3/class_assembly.html#29c4ddd858d5dd7d25cecfb466eba4a5">putOnGround</a>();
<a name="l00865"></a>00865 
<a name="l00866"></a>00866         <span class="comment">//add assembly to root node</span>
<a name="l00867"></a>00867         <a class="code" href="../../d6/db5/class_scene.html#3b1725940a2ed0b1eea9c9ab023e770b">m_RootAssembly</a>-&gt;<a class="code" href="../../d5/de3/class_assembly.html#81b768170169fb530d07052578fbfcbc">addPart</a>(assembly);
<a name="l00868"></a>00868 
<a name="l00869"></a>00869         <span class="comment">//refresh both</span>
<a name="l00870"></a>00870         <a class="code" href="../../d6/db5/class_scene.html#bbf21c78f3e75ea87f49df29e28c9997">refreshTreeAndCanvas</a>();
<a name="l00871"></a>00871 }
<a name="l00872"></a>00872 
<a name="l00876"></a><a class="code" href="../../d6/db5/class_scene.html#bbf21c78f3e75ea87f49df29e28c9997">00876</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/db5/class_scene.html#bbf21c78f3e75ea87f49df29e28c9997">Scene::refreshTreeAndCanvas</a>()
<a name="l00877"></a>00877 {
<a name="l00878"></a>00878         <span class="comment">//refresh canvas</span>
<a name="l00879"></a>00879         <a class="code" href="../../d6/db5/class_scene.html#5b81137c9b7c995108175d8a24f822ae">glRefresh</a>();
<a name="l00880"></a>00880 
<a name="l00881"></a>00881         <span class="comment">//send event to refresh Scene-Tree</span>
<a name="l00882"></a>00882         <a class="code" href="../../d1/d0e/class_notify_event.html">NotifyEvent</a> gnrevent(wxEVT_COMMAND_GNR_NOTIFY);
<a name="l00883"></a>00883         gnrevent.<a class="code" href="../../d1/d0e/class_notify_event.html#f51e30f058656f7f19536efc049be923">setGNREventType</a>(<a class="code" href="../../dd/dd8/_enum_8h.html#3017adf344c435005db11e8c0d8c03bd92d1c11b5acee51a4090d8c1ae57a6f0">REFRESHSCENETREE</a>);
<a name="l00884"></a>00884         ProcessEvent(gnrevent);
<a name="l00885"></a>00885 
<a name="l00886"></a>00886         <a class="code" href="../../d6/db5/class_scene.html#5b81137c9b7c995108175d8a24f822ae">glRefresh</a>();
<a name="l00887"></a>00887 }
<a name="l00888"></a>00888 
<a name="l00893"></a><a class="code" href="../../d6/db5/class_scene.html#107c53e38c8cdf2554fb210774329757">00893</a> <a class="code" href="../../d5/de3/class_assembly.html">Assembly</a>* <a class="code" href="../../d6/db5/class_scene.html#107c53e38c8cdf2554fb210774329757">Scene::getTrash</a>()
<a name="l00894"></a>00894 {
<a name="l00895"></a>00895         <span class="keywordflow">return</span> <a class="code" href="../../d6/db5/class_scene.html#3d621c528dca6465b8f461b42378a860">m_Trash</a>;
<a name="l00896"></a>00896 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sun Nov 9 13:10:35 2008 for ProjectGNR by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
